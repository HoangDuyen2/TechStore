<html lang="en">

<meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
<head th:replace="~{web/fragments/head :: head('TechStore - Sản phẩm')}"></head>
<style>
    .custom-sort-dropdown {
        position: relative;
        display: inline-block;
        font-size: 16px;
        user-select: none;
    }

    .sort-label {
        margin-right: 6px;
        font-weight: 500;
    }

    .sort-button {
        background: #fff;
        border: 1px solid #ccc;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-weight: 500;
    }

    .sort-dropdown-list {
        position: absolute;
        top: 100%;
        left: 0;
        margin-top: 5px;
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        list-style: none;
        padding: 8px 0;
        min-width: 240px;
        display: none;
        z-index: 100;
    }

    .sort-dropdown-list li {
        padding: 10px 16px;
        cursor: pointer;
        transition: background 0.2s;
    }

    .sort-dropdown-list li:hover {
        background-color: #f4f4f4;
    }

    .sort-dropdown-list.show {
        display: block;
    }
</style>
<body>
<!-- header-area start -->
<div th:insert="~{web/fragments/header::header}"></div>
<!-- header end -->
<div th:insert="~{web/fragments/main_menu::main-menu}"></div>
<main>
    <!-- breadcrumb start -->
    <section class="breadcrumb-area">
        <div class="container">
            <div class="col">
                <div class="row">
                    <div class="breadcrumb-index">
                        <!-- breadcrumb-list start -->
                        <ul class="breadcrumb-ul">
                            <li class="breadcrumb-li">
                                <a class="breadcrumb-link" href="index1.html">Home</a>
                            </li>
                            <li class="breadcrumb-li">
                                <span class="breadcrumb-text">Products</span>
                            </li>
                        </ul>
                        <!-- breadcrumb-list end -->
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- breadcrumb end -->
    <!-- collection start -->
    <section class="main-content-wrap bg-color shop-page section-ptb">
        <div class="container">
            <div class="row">
                <div class="col">
                    <div class="pro-grli-wrapper left-side-wrap">
                        <div class="pro-grli-wrap product-grid">
                            <div class="collection-img-wrap" data-animate="animate__fadeInUp">
                            </div>
                            <!-- shop-top-bar start -->
                            <div class="shop-top-bar">
                                <div class="product-filter without-sidebar">
                                    <button class="filter-button" type="button"><i class="fa-solid fa-filter"></i><span>Filter</span>
                                    </button>
                                </div>
                                <div class="product-view-mode">
                                    <!-- shop-item-filter-list start -->
                                    <a href="javascript:void(0)" class="list-change-view grid-three active"
                                       data-grid-view="3"><i class="fa-solid fa-border-all"></i></a>
                                    <!-- shop-item-filter-list end -->
                                </div>
                                <!-- product-short start -->
                                <div class="product-short">
                                    <div class="custom-sort-dropdown">
                                        <span class="sort-label">Sort by:</span>
                                        <div class="sort-button" onclick="toggleSortDropdown()">
                                            <span id="currentSortText">Select</span>
                                            <i class="feather-chevron-down"></i>
                                        </div>
                                        <ul class="sort-dropdown-list" id="sortDropdownList">
                                            <li data-value="title-ascending">Alphabetically, A-Z</li>
                                            <li data-value="title-descending">Alphabetically, Z-A</li>
                                            <li data-value="price-ascending">Price, low to high</li>
                                            <li data-value="price-descending">Price, high to low</li>
                                            <li data-value="created-descending">Date, new to old</li>
                                            <li data-value="created-ascending">Date, old to new</li>
                                        </ul>
                                    </div>
                                </div>
                                <!-- product-short end -->
                            </div>
                            <!-- shop-top-bar end -->
                            <!-- Latest-product start -->
                            <div class="special-product grid-3">
                                <div class="collection-category">
                                    <div class="row">
                                        <div class="col">
                                            <div class="collection-wrap">
                                                <ul class="product-view-ul">
                                                    <!-- Vòng lặp danh sách sản phẩm -->
                                                    <th:block th:each="product : ${products}">
                                                        <li class="pro-item-li" data-animate="animate__fadeInUp">
                                                            <div class="single-product-wrap">
                                                                <div class="product-image">
                                                                    <a th:href="@{/product/{id}(id=${product.id})}" class="pro-img">
                                                                        <img th:src="${product.thumbnail}" class="img-fluid img1 resp-img1" th:alt="${product.name}">
                                                                        <img th:src="${product.thumbnail}" class="img-fluid img2 resp-img2" th:alt="${product.name}">
                                                                    </a>
                                                                    <div class="product-action">
                                                                        <a href="#" class="quickview" th:data-product-id="${product.getId()}">
                                                                            <span class="product-icon"><i class="feather-eye"></i></span>
                                                                            <span class="tooltip-text">quickview</span>
                                                                        </a>
                                                                    </div>
                                                                    <div th:attr="data-authenticated=${user != null}"></div>
                                                                    <div th:attr="data-authenticated=${user != null}"></div>
                                                                    <div class="product-cart">
                                                                        <button type="button" class="add-to-cart"
                                                                                th:attr="data-product-id=${product.id}"
                                                                                onclick="addToCart(this)">
                                                                        <span class="product-icon">
                                                                            <span class="product-bag-icon"><i class="feather-shopping-bag"></i></span>
                                                                            <span class="product-loader-icon"><i class="feather-loader"></i></span>
                                                                            <span class="product-check-icon"><i class="feather-check"></i></span>
                                                                        </span>
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                                <div class="product-caption">
                                                                    <div class="product-content">
                                                                        <div class="product-title">
                                                                            <h6><a th:href="@{/products/{id}(id=${product.id})}" th:text="${product.name}"></a></h6>
                                                                        </div>
                                                                        <div class="price-box">
                                                                            <span class="new-price" th:text="${product.price}"></span>
                                                                        </div>
                                                                        <div class="product-ratting">
                                                                            <span class="review-ratting">
                                                                                <span class="review-star">
                                                                                    <span th:if="${product.getStars() > 0}">
                                                                                        <span th:each="i : ${#numbers.sequence(1, product.stars)}">
                                                                                            <i class="fas fa-star"></i>
                                                                                        </span>
                                                                                    </span>
                                                                                    <span th:if="${product.getStars() < 5}">
                                                                                        <span th:each="i : ${#numbers.sequence(1, 5 - product.stars)}">
                                                                                            <i class="feather-star"></i>
                                                                                        </span>
                                                                                    </span>
                                                                                </span>
                                                                                <span class="review-caption">No reviews</span>
                                                                            </span>
                                                                        </div>
                                                                        <div class="product-action">
                                                                            <a th:href="@{/add-cart}" class="add-to-cart">
                                                                                <span class="product-icon">
                                                                                    <span class="product-bag-icon"><i
                                                                                            class="feather-shopping-bag"></i></span>
                                                                                    <span class="product-loader-icon"><i
                                                                                            class="feather-loader"></i></span>
                                                                                    <span class="product-check-icon"><i
                                                                                            class="feather-check"></i></span>
                                                                                </span>
                                                                                <span class="tooltip-text">add to cart</span>
                                                                            </a>
                                                                            <a href="#quickview-modal" data-bs-toggle="modal" class="quick-view">
                                                                                <span class="product-icon"><i class="feather-eye"></i></span>
                                                                                <span class="tooltip-text">quickview</span>
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    </th:block>
                                                </ul>
                                            </div>

                                            <input type="hidden" id="totalPages" th:value="${totalPages}">
                                            <div th:if="${totalPages == 0}" id="error-notification">
                                                <div class="empty-notification" display="flex" align="center">
                                                    <img th:src="@{/web/assert/image/home1/myimages/no-product.avif}" alt="Error Notification">
                                                </div>
                                            </div>

                                            <div th:if="${totalPages != 0}" class="paginatoin-area" data-animate="animate__fadeInUp">
                                                <ul class="pagination-page-box animate__fadeInUp animate__animated" data-animate="animate__fadeInUp">

                                                    <!-- Nút Previous -->
                                                    <li class="page-prev" th:if="${pageNumber > 0}">
                                                        <a th:href="@{${baseUrl} + 'pageNumber=' + (${pageNumber - 1}) + '&pageSize=' + ${pageSize} + '&sortBy=' + ${sortBy} + '&sortOrder=' + ${sortOrder}}"
                                                           class="theme-glink">
                                                            <i class="fa-solid fa-angle-left"></i>
                                                        </a>
                                                    </li>

                                                    <!-- Các số trang -->
                                                    <li class="number"
                                                        th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                                                        th:classappend="${i == pageNumber} ? 'active' : ''">
                                                        <a th:href="@{${baseUrl} + 'pageNumber=' + ${i} + '&pageSize=' + ${pageSize} + '&sortBy=' + ${sortBy} + '&sortOrder=' + ${sortOrder}}"
                                                           th:text="${i + 1}"
                                                           class="theme-glink"></a>
                                                    </li>

                                                    <!-- Nút Next -->
                                                    <li class="page-next" th:if="${pageNumber < totalPages - 1}">
                                                        <a th:href="@{${baseUrl} + 'pageNumber=' + (${pageNumber + 1}) + '&pageSize=' + ${pageSize} + '&sortBy=' + ${sortBy} + '&sortOrder=' + ${sortOrder}}"
                                                           class="theme-glink">
                                                            <i class="fa-solid fa-angle-right"></i>
                                                        </a>
                                                    </li>

                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Latest-product end -->
                        </div>
                        <div class="pro-grli-wrap product-sidebar">
                            <div class="pro-grid-block">
                                <div class="shop-sidebar-inner">
                                    <div class="shop-sidebar-wrap filter-sidebar">
                                        <!-- button start -->
                                        <button class="close-sidebar" type="button">
                                            <i class="fa-solid fa-xmark"></i>
                                        </button>
                                        <!-- button end -->
                                        <!-- filter-form start -->
                                        <div class="facets">
                                            <form class="facets-form" action="/products" method="get" >

                                                <input type="hidden" name="brandNames" id="brandNamesInput" th:value="${param.brandNames}">
                                                <input type="hidden" name="minPrice" id="minPriceInput" th:value="${param.minPrice}">
                                                <input type="hidden" name="maxPrice" id="maxPriceInput" th:value="${param.maxPrice}">
                                                <input type="hidden" name="os" id="osInput" th:value="${param.os}">
                                                <input type="hidden" name="processor" id="processorInput" th:value="${param.processor}">
                                                <input type="hidden" name="sim" id="simInput" th:value="${param.sim}">
                                                <input type="hidden" name="connectivity" id="connectivityInput" th:value="${param.connectivity}">

                                                <div class="facets-wrapper">
                                                    <!-- Product-Categories start -->

                                                    <div class="filter-info" style="display: flex; justify-content: space-between;">
                                                        <a th:href="@{/products}"  class="reset-text">Reset</a>
                                                        <button type="submit" class="axil-btn btn-outline-primary" id="filterButton">Filter</button>
                                                    </div>
                                                    <br>
                                                    <input class="form-control mr-sm-2" type="search" placeholder="Search" name="name" aria-label="Search" th:value="${param.name}">

                                                    <div class="shop-sidebar" data-animate="animate__fadeInUp">
                                                        <h6 class="shop-title" data-animate="animate__fadeInUp">
                                                            Brands</h6>
                                                        <a href="#collapse-5" data-bs-toggle="collapse"
                                                           class="shop-title shop-title-lg">
                                                            Brand<i class="feather-chevron-down"></i>
                                                        </a>
                                                        <div class="collapse show shop-element" id="collapse-5">
                                                            <ul class="brand-ul scrollbar">
                                                                <!-- Lặp qua danh sách brands từ model -->
                                                                <th:block th:each="brand : ${brands}">
                                                                    <li class="cat-checkbox"
                                                                        data-animate="animate__fadeInUp">
                                                                        <label class="checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox brand-check"
                                                                                   th:value="${brand.name}"
                                                                                   onchange="updateSelectedBrands()"
                                                                                   th:checked="${param.brandNames != null and #lists.contains(#strings.arraySplit(param.brandNames, ','), brand.name)}">
                                                                            <span class="check-name"
                                                                                  th:text="${brand.name}">Brand Name</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                </th:block>
                                                            </ul>
                                                        </div>
                                                    </div>

                                                    <!-- Product-Categories end -->
                                                    <div class="shop-sidebar sidebar-price">
                                                        <h6 class="shop-title" data-animate="animate__fadeInUp">
                                                            Price</h6>
                                                        <a href="#collapse-3" data-bs-toggle="collapse"
                                                           class="shop-title shop-title-lg">Price</a>
                                                        <div class="filter-info" data-animate="animate__fadeInUp">
                                                            <span class="shop-price">The highest price is 100.000.000VNĐ</span>
                                                            </facet-remove>
                                                        </div>
                                                        <!-- Product-price start -->
                                                        <div class="collapse price-wrap" id="collapse-3"
                                                             data-animate="animate__fadeInUp">
                                                            <price-range class="price-range">
                                                                <div class="price-range-group group-range">
                                                                    <input type="range" class="range" min="0" max="100"
                                                                           value="0" id="range1">
                                                                    <input type="range" class="range" min="0" max="100"
                                                                           value="100" id="range2">
                                                                </div>
                                                                <div class="price-input-group group-input"
                                                                     data-animate="animate__fadeInUp">
                                                                    <div class="price-range-input input-price">
                                                                        <label class="label-text">From</label>
                                                                        <span class="price-value">Triệu</span>
                                                                        <span id="demo1" class="price-field">0</span>
                                                                    </div>
                                                                    <span class="price-range-delimeter">-</span>
                                                                    <div class="price-range-input input-price">
                                                                        <label class="label-text">To</label>
                                                                        <span class="price-value">Triệu</span>
                                                                        <span id="demo2" class="price-field">100</span>
                                                                    </div>
                                                                </div>
                                                            </price-range>
                                                        </div>
                                                        <!-- Product-price end -->
                                                        <!-- Product Operasystem -->
                                                        <div class="shop-sidebar sidebar-product" data-animate="animate__fadeInUp">
                                                            <h6 class="shop-title" >Operating System</h6>
                                                            <div class="collapse filter-element" id="collapse-2">
                                                                <ul class="brand-ul scrollbar">
                                                                    <li>
                                                                        <label class="cust-checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox os-check" value="iOS"
                                                                                   onchange="updateAllFilters()"
                                                                                   th:checked="${param.os != null and #lists.contains(#strings.arraySplit(param.os, ','), 'iOS')}">
                                                                            <span class="filter-name">iOS</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                    <li>
                                                                        <label class="cust-checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox os-check" value="Android"
                                                                                   onchange="updateAllFilters()"
                                                                                   th:checked="${param.os != null and #lists.contains(#strings.arraySplit(param.os, ','), 'Android')}">
                                                                            <span class="filter-name">Android</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                    <li>
                                                                        <label class="cust-checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox os-check" value="MIUI"
                                                                                   onchange="updateAllFilters()"
                                                                                   th:checked="${param.os != null and #lists.contains(#strings.arraySplit(param.os, ','), 'MIUI')}">
                                                                            <span class="filter-name">MIUI</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                    <li>
                                                                        <label class="cust-checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox os-check" value="ColorOS"
                                                                                   onchange="updateAllFilters()"
                                                                                   th:checked="${param.os != null and #lists.contains(#strings.arraySplit(param.os, ','), 'ColorOS')}">
                                                                            <span class="filter-name">ColorOS</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                    <li>
                                                                        <label class="cust-checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox os-check" value="HyperOS"
                                                                                   onchange="updateAllFilters()"
                                                                                   th:checked="${param.os != null and #lists.contains(#strings.arraySplit(param.os, ','), 'HyperOS')}">
                                                                            <span class="filter-name">HyperOS</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                        <!-- Product Operasystem end-->
                                                        <!-- Product Operasystem -->
                                                        <div class="shop-sidebar sidebar-product" data-animate="animate__fadeInUp">
                                                            <h6 class="shop-title" >Processor</h6>
                                                            <div class="collapse filter-element" id="collapse-1">
                                                                <ul class="brand-ul scrollbar">
                                                                    <li>
                                                                        <label class="cust-checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox processor-check" value="Snapdragon"
                                                                                   onchange="updateAllFilters()"
                                                                                   th:checked="${param.processor != null and #lists.contains(#strings.arraySplit(param.processor, ','), 'Snapdragon')}">
                                                                            <span class="filter-name">Snapdragon</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                    <li>
                                                                        <label class="cust-checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox processor-check" value="MediaTek"
                                                                                   onchange="updateAllFilters()"
                                                                                   th:checked="${param.processor != null and #lists.contains(#strings.arraySplit(param.processor, ','), 'MediaTek')}">
                                                                            <span class="filter-name">MediaTek</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                    <li>
                                                                        <label class="cust-checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox processor-check" value="Bionic"
                                                                                   onchange="updateAllFilters()"
                                                                                   th:checked="${param.processor != null and #lists.contains(#strings.arraySplit(param.processor, ','), 'Bionic')}">
                                                                            <span class="filter-name">Bionic</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                    <li>
                                                                        <label class="cust-checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox processor-check" value="Exynos"
                                                                                   onchange="updateAllFilters()"
                                                                                   th:checked="${param.processor != null and #lists.contains(#strings.arraySplit(param.processor, ','), 'Exynos')}">
                                                                            <span class="filter-name">Exynos</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                        <!-- Product Operasystem end-->
                                                        <!-- Product Sim -->
                                                        <div class="shop-sidebar sidebar-product" data-animate="animate__fadeInUp">
                                                            <h6 class="shop-title" >Sim</h6>
                                                            <div class="collapse filter-element" id="collapse-4">
                                                                <ul class="brand-ul scrollbar">
                                                                    <li>
                                                                        <label class="cust-checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox sim-check" value="eSIM"
                                                                                   onchange="updateAllFilters()"
                                                                                   th:checked="${param.sim != null and #lists.contains(#strings.arraySplit(param.sim, ','), 'eSIM')}">
                                                                            <span class="filter-name">eSIM</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                    <li>
                                                                        <label class="cust-checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox sim-check" value="Nano"
                                                                                   onchange="updateAllFilters()"
                                                                                   th:checked="${param.sim != null and #lists.contains(#strings.arraySplit(param.sim, ','), 'Nano')}">
                                                                            <span class="filter-name">Nano</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                    <li>
                                                                        <label class="cust-checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox sim-check" value="Dual"
                                                                                   onchange="updateAllFilters()"
                                                                                   th:checked="${param.sim != null and #lists.contains(#strings.arraySplit(param.sim, ','), 'Dual')}">
                                                                            <span class="filter-name">Dual</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                        <!-- Product Sim end-->
                                                        <!-- Product Connection-->
                                                        <div class="shop-sidebar sidebar-product" data-animate="animate__fadeInUp">
                                                            <h6 class="shop-title" >Connection</h6>
                                                            <div class="collapse filter-element" id="collapse-6">
                                                                <ul class="brand-ul scrollbar">
                                                                    <li>
                                                                        <label class="cust-checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox conn-check" value="Wi-Fi"
                                                                                   onchange="updateAllFilters()"
                                                                                   th:checked="${param.connectivity != null and #lists.contains(#strings.arraySplit(param.connectivity, ','), 'Wi-Fi')}">
                                                                            <span class="filter-name">Wi-Fi</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                    <li>
                                                                        <label class="cust-checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox conn-check" value="Wi-Fi 7"
                                                                                   onchange="updateAllFilters()"
                                                                                   th:checked="${param.connectivity != null and #lists.contains(#strings.arraySplit(param.connectivity, ','), 'Wi-Fi 7')}">
                                                                            <span class="filter-name">Wi-Fi 7</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                    <li>
                                                                        <label class="cust-checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox conn-check" value="5G"
                                                                                   onchange="updateAllFilters()"
                                                                                   th:checked="${param.connectivity != null and #lists.contains(#strings.arraySplit(param.connectivity, ','), '5G')}">
                                                                            <span class="filter-name">5G</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                    <li>
                                                                        <label class="cust-checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox conn-check" value="4G"
                                                                                   onchange="updateAllFilters()"
                                                                                   th:checked="${param.connectivity != null and #lists.contains(#strings.arraySplit(param.connectivity, ','), '4G')}">
                                                                            <span class="filter-name">4G</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                    <li>
                                                                        <label class="cust-checkbox-label">
                                                                            <input type="checkbox" class="cust-checkbox conn-check" value="NFC"
                                                                                   onchange="updateAllFilters()"
                                                                                   th:checked="${param.connectivity != null and #lists.contains(#strings.arraySplit(param.connectivity, ','), 'NFC')}">
                                                                            <span class="filter-name">NFC</span>
                                                                            <span class="cust-check"></span>
                                                                        </label>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                        <!-- Product Connection end-->
                                                    </div>

                                                </div>
                                            </form>
                                        </div>
                                        <!-- filter-form end -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- collection end -->
</main>
<!-- main end -->
<!-- footer start -->
<div th:insert="~{web/fragments/footer::footer}"></div>
<!-- footer end -->
<!-- quickview modal start -->
<div class="modal fade quickview-modal" id="quickview-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="quickview-content"></div>
            </div>
        </div>
    </div>
</div>
<!-- quickview modal end -->
<!-- cart-drawer start -->
<div th:insert="~{web/fragments/cart_drawer::cart-drawer}"></div>
<!-- cart-drawer end -->
<!-- fullscreen start -->
<div class="bg-screen"></div>
<!-- fullscreen end -->
<!-- back-to-top start -->
<a href="javascript:void(0)" id="top" class="scroll"><span><i class="feather-arrow-up"></i></span></a>
<!-- back-to-top end -->
<!-- plugin js -->
<script th:src="@{/web/assert/js/plugin.js}"></script>
<!-- theme js -->
<script th:src="@{/web/assert/js/main.js}"></script>
<script th:src="@{/web/assert/js/search-autocomplete.js}"></script>

<script>
    const rangeMin = document.getElementById('range1');
    const rangeMax = document.getElementById('range2');
    const minPriceInput = document.getElementById('minPriceInput');
    const maxPriceInput = document.getElementById('maxPriceInput');

    function updateSelectedBrands() {
        const selectedBrands = Array.from(document.querySelectorAll('.brand-check:checked'))
            .map(cb => cb.value)
            .join(',');
        document.getElementById('brandNamesInput').value = selectedBrands;
    }

    function updateSelectedValues(className, hiddenInputId) {
        const selected = Array.from(document.querySelectorAll('.' + className + ':checked'))
            .map(cb => cb.value.trim())
            .filter(v => v !== '')
            .join(',');
        const input = document.getElementById(hiddenInputId);
        if (input) input.value = selected;
    }

    function updateAllFilters() {
        updateSelectedBrands();
        updateSelectedValues('os-check', 'osInput');
        updateSelectedValues('processor-check', 'processorInput');
        updateSelectedValues('sim-check', 'simInput');
        updateSelectedValues('conn-check', 'connectivityInput');
    }

    function updatePriceInputs() {
        let min = parseInt(rangeMin.value);
        let max = parseInt(rangeMax.value);

        if (min > max) {
            [min, max] = [max, min];
        }

        minPriceInput.value = min * 1_000_000;
        maxPriceInput.value = max * 1_000_000;

        document.getElementById("demo1").innerText = min;
        document.getElementById("demo2").innerText = max;
    }

    document.addEventListener('DOMContentLoaded', function () {
        updateAllFilters();

        const min = parseInt(minPriceInput.value) / 1_000_000 || 0;
        const max = parseInt(maxPriceInput.value) / 1_000_000 || 100;

        rangeMin.value = min;
        rangeMax.value = max;

        document.getElementById("demo1").innerText = min;
        document.getElementById("demo2").innerText = max;
    });

    rangeMin.addEventListener('input', updatePriceInputs);
    rangeMax.addEventListener('input', updatePriceInputs);

    document.querySelector('.facets-form').addEventListener('submit', function (e) {
        updatePriceInputs();
        updateAllFilters();

        this.querySelectorAll('input[type="hidden"]').forEach(input => {
            if (!input.value || input.value.trim() === '') {
                input.remove();
            }
        });

        const nameInput = this.querySelector('input[name="name"]');
        if (nameInput && nameInput.value.trim() === '') {
            nameInput.remove();
        }
    });
</script>
<script>
    function toggleSortDropdown() {
        const dropdown = document.getElementById("sortDropdownList");
        dropdown.classList.toggle("show");
    }

    function mapSortLabel(sortBy, sortOrder) {
        if (sortBy === "name" && sortOrder === "asc") return "Alphabetically, A-Z";
        if (sortBy === "name" && sortOrder === "desc") return "Alphabetically, Z-A";
        if (sortBy === "price" && sortOrder === "asc") return "Price, low to high";
        if (sortBy === "price" && sortOrder === "desc") return "Price, high to low";
        if (sortBy === "createdAt" && sortOrder === "desc") return "Date, new to old";
        if (sortBy === "createdAt" && sortOrder === "asc") return "Date, old to new";
        return "Select";
    }

    function parseSortValue(dataValue) {
        switch (dataValue) {
            case "title-ascending": return { sortBy: "name", sortOrder: "asc" };
            case "title-descending": return { sortBy: "name", sortOrder: "desc" };
            case "price-ascending": return { sortBy: "price", sortOrder: "asc" };
            case "price-descending": return { sortBy: "price", sortOrder: "desc" };
            case "created-descending": return { sortBy: "createdAt", sortOrder: "desc" };
            case "created-ascending": return { sortBy: "createdAt", sortOrder: "asc" };
            default: return null;
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        const dropdownItems = document.querySelectorAll("#sortDropdownList li");
        const currentText = document.getElementById("currentSortText");

        // ✅ Đọc từ URL để gán lại nhãn dropdown
        const urlParams = new URLSearchParams(window.location.search);
        const sortBy = urlParams.get("sortBy");
        const sortOrder = urlParams.get("sortOrder");
        const label = mapSortLabel(sortBy, sortOrder);
        currentText.textContent = label;

        // Khi click chọn sort mới
        dropdownItems.forEach(item => {
            item.addEventListener("click", function () {
                const dataValue = this.getAttribute("data-value");
                const sort = parseSortValue(dataValue);

                if (sort) {
                    const newUrl = new URL(window.location.href);
                    newUrl.searchParams.set("sortBy", sort.sortBy);
                    newUrl.searchParams.set("sortOrder", sort.sortOrder);
                    newUrl.searchParams.set("pageNumber", 0); // Reset về trang đầu
                    window.location.href = newUrl.toString();
                }
            });
        });

        // Đóng nếu click ra ngoài
        document.addEventListener("click", function (event) {
            const dropdown = document.getElementById("sortDropdownList");
            const trigger = document.querySelector(".sort-button");
            if (!dropdown.contains(event.target) && !trigger.contains(event.target)) {
                dropdown.classList.remove("show");
            }
        });
    });
</script>
<script>
    function addToCart(button) {
        const isAuthenticated = [[${#authentication.principal != 'anonymousUser'}]];
        if (!isAuthenticated) {
            window.location.href = "/login";
            return;
        }

        const productId = button.getAttribute('data-product-id');

        fetch(`/add-cart?productId=${productId}`, {
            method: 'GET'
        })
            .then(response => {
                if (response.ok) {
                    return response.text();
                } else {
                    throw new Error('Thêm thất bại!');
                }
            })
            .then(data => {
                alert(data);
                location.reload();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Có lỗi xảy ra!');
            });
    }
</script>
<script>
    function increaseQuantity(button) {
        console.log("increaseQuantity called");
        const productId = getProductId(button);
        fetch(window.location.origin + "/add-cart?productId=" + productId)
            .then(response => {
                if (response.ok) {
                    return response.text();
                }
                throw new Error('Tăng số lượng thất bại!');
            })
            .then(data => {
                alert(data);
                location.reload();
            })
            .catch(error => {
                console.error('Error:', error);
                alert(error.message);
            });
    }

    function decreaseQuantity(button) {
        console.log("decreaseQuantity called");
        const productId = getProductId(button);
        fetch(window.location.origin + "/decrease-cart?productId=" + productId)
            .then(response => {
                if (response.ok) {
                    return response.text();
                }
                throw new Error('Giảm số lượng thất bại!');
            })
            .then(data => {
                alert(data);
                location.reload();
            })
            .catch(error => {
                console.error('Error:', error);
                alert(error.message);
            });
    }

    function deleteItem(button) {
        console.log("deleteItem called");
        const productId = getProductId(button);
        fetch(window.location.origin + "/delete-cart?productId=" + productId)
            .then(response => {
                if (response.ok) {
                    return response.text();
                }
                throw new Error('Xóa sản phẩm thất bại!');
            })
            .then(data => {
                alert(data);
                location.reload();
            })
            .catch(error => {
                console.error('Error:', error);
                alert(error.message);
            });
    }

    function getProductId(button) {
        const cartItem = button.closest('.cart-item');
        return cartItem ? cartItem.getAttribute('data-product-id') : null;
    }
</script>
<script>
    // Quickview functionality
    document.addEventListener('DOMContentLoaded', function() {
        const quickviewButtons = document.querySelectorAll('.quickview');

        quickviewButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const productId = this.getAttribute('data-product-id');

                // Load quickview content
                fetch(`/products/quickview/${productId}`)
                    .then(response => response.text())
                    .then(html => {
                        document.getElementById('quickview-content').innerHTML = html;

                        // Initialize modal
                        const modal = new bootstrap.Modal(document.getElementById('quickview-modal'));
                        modal.show();

                        // Initialize Swiper for quickview slider
                        const galleryThumbs = new Swiper('.gallery-thumbs', {
                            spaceBetween: 10,
                            slidesPerView: 4,
                            freeMode: true,
                            watchSlidesVisibility: true,
                            watchSlidesProgress: true,
                        });

                        const galleryTop = new Swiper('.gallery-top', {
                            spaceBetween: 10,
                            navigation: {
                                nextEl: '.quick-next',
                                prevEl: '.quick-prev',
                            },
                            thumbs: {
                                swiper: galleryThumbs
                            }
                        });
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Có lỗi xảy ra khi tải quickview!');
                    });
            });
        });
    });
</script>
</body>
</html>